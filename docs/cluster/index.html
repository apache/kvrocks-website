<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-cluster">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Cluster | Apache Kvrocks™</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kvrocks.apache.org/docs/cluster"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Cluster | Apache Kvrocks™"><meta data-rh="true" name="description" content="Before releasing the cluster mode of Apache Kvrocks™, we usually used the pre-sharding way to scale out the capacity like sharding with Twemproxy, and used Redis Sentinel to guarantee the availability. Although it works well in most scenes since the capacity of Kvrocks is far larger than Redis, it’s still hard to scale-out in-flight, so we decided to implement the cluster mode to make it easier."><meta data-rh="true" property="og:description" content="Before releasing the cluster mode of Apache Kvrocks™, we usually used the pre-sharding way to scale out the capacity like sharding with Twemproxy, and used Redis Sentinel to guarantee the availability. Although it works well in most scenes since the capacity of Kvrocks is far larger than Redis, it’s still hard to scale-out in-flight, so we decided to implement the cluster mode to make it easier."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kvrocks.apache.org/docs/cluster"><link data-rh="true" rel="alternate" href="https://kvrocks.apache.org/docs/cluster" hreflang="en"><link data-rh="true" rel="alternate" href="https://kvrocks.apache.org/docs/cluster" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Kvrocks™ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Kvrocks™ Atom Feed"><link rel="stylesheet" href="/assets/css/styles.22f4841c.css">
<link rel="preload" href="/assets/js/runtime~main.aee82a85.js" as="script">
<link rel="preload" href="/assets/js/main.494d9540.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="apache-kvrocks" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="apache-kvrocks" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Apache Kvrocks</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/getting-started">Docs</a><a class="navbar__item navbar__link" href="/download">Download</a><a class="navbar__item navbar__link" href="/community/">Community</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/users">Users</a><a href="https://github.com/apache/kvrocks" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Foundation</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li></ul></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/getting-started">Getting started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/namespace">Namespace</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/cluster">Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/kvrocks-search">Search</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/replication">Replication</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/docs/category/operation">Operation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Operation&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/backup">Backup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kvrocks-exporter">Metrics Exporter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/kvrocks2redis">kvrocks2redis</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/docs/category/references">References</a><button aria-label="Toggle the collapsible sidebar category &#x27;References&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/supported-commands">Supported commands</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/info-sections">INFO sections</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faq">FAQs</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Cluster</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Cluster</h1><p>Before releasing the cluster mode of Apache Kvrocks™, we usually used the pre-sharding way to scale out the capacity like sharding with Twemproxy, and used Redis Sentinel to guarantee the availability. Although it works well in most scenes since the capacity of Kvrocks is far larger than Redis, it’s still hard to scale-out in-flight, so we decided to implement the cluster mode to make it easier.</p><p>There are two main types of Redis cluster solutions in the industry:</p><ul><li>Redis cluster decentralized solution</li><li>Codis centralized solution</li></ul><p>For Redis cluster solution, the biggest advantage is NOT needing to depend on other components, but the shortcoming is also obvious that it&#x27;s hard to write the right implementation and not easy to maintain the cluster topology. Another big issue is Gossip protocol would limit the cluster size.</p><p>For Codis solution, we need to introduce a proxy and centralized storage to keep the metadata, the proxy also added extra network communication cost and delay.</p><p>In Kvrocks cluster design, we want to integrate advantages of both solutions: that is, you can access Kvrocks without the proxy, and scale-out easily.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="architect">Architect<a href="#architect" class="hash-link" aria-label="Direct link to Architect" title="Direct link to Architect">​</a></h2><p>Each Kvrocks node can act as Redis node which can offer the cluster topology directly, and the Redis cluster client can also work on the Kvrocks cluster without any modifications. The topology is managed by the other control panel component which can avoid the complexity of the Gossip protocol(Redis community takes many years to complete the Gossip on cluster solution).</p><p><img loading="lazy" alt="cluster" src="/assets/images/cluster-3bf45cdcb0c197a26753abd6d6975353.png" width="519" height="326" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="topology-management">Topology management<a href="#topology-management" class="hash-link" aria-label="Direct link to Topology management" title="Direct link to Topology management">​</a></h2><p>Kvrocks uses the <a href="https://github.com/apache/kvrocks/pull/302" target="_blank" rel="noopener noreferrer">CLUSTERX SETNODES</a> command to set up the cluster topology, be careful that we should apply the entire topology information to all nodes since nodes didn&#x27;t communicate with each other. The command is like below:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CLUSTERX SETNODES </span><span class="token variable" style="color:#36acaa">$ALL_NODES_INFO</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$VERSION</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$FORCE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>$ALL_NODES_INFO</code> is the cluster topology information in format (note that newline is required between different nodes):</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token variable" style="color:#36acaa">$node_id</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$ip</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$port</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$role</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$master_node_id</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$slot_range</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where</p><ul><li><code>$node_id</code>: 40 chars string, it represents as the unique id in the cluster</li><li><code>$ip</code> and <code>$port</code>: the node IP address and the listening port</li><li><code>$role</code>: node&#x27;s role, should be one of <code>master</code> or <code>slave</code></li><li><code>$master_node_id</code>: set to the master node id when the current node&#x27;s role is a slave; <code>-</code> if it&#x27;s master</li><li><code>$slot_range</code>: slots are served by current node, the format can be the range or single value, like <code>0-100 200 205</code>, which means slots 0 to 100, 200 and 205 are served by this node</li></ul><p><code>$VERSION</code> is the topology information version used to control update the order. The topology information can be updated if the version is newer than the current version.</p><p><code>$FORCE</code> (0 or 1) indicates force update the topology information without verifying the version, you can use this flag when the topology information is totally broken. For example:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CLUSTERX SETNODES </span><span class="token string" style="color:#e3116c">&quot;kvrockskvrockskvrockskvrockskvrocksnode1 10.32.68.251 6666 master - 0-5460 </span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c"> kvrockskvrockskvrockskvrockskvrocksnode2 10.32.68.250 6667 master - 5461-10992 </span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c"> kvrockskvrockskvrockskvrockskvrocksnode3 10.32.68.249 6666 master - 10993-16383&quot;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Although Kvrocks can recognize the node id by comparing the <code>ip:port</code> pair then finding out the serving slots, but users may set the IP address to <code>0.0.0.0</code> so that we can&#x27;t match the right topology information. Thus, Kvrocks gives the extra command <a href="https://github.com/apache/kvrocks/pull/302" target="_blank" rel="noopener noreferrer">CLUSTERX SETNODEID</a> to set the id. The format is like this:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CLUSTERX SETNODEID </span><span class="token variable" style="color:#36acaa">$NODE_ID</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>$NODE_ID</code> should be 40 chars unique id in cluster.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="node-management">Node management<a href="#node-management" class="hash-link" aria-label="Direct link to Node management" title="Direct link to Node management">​</a></h2><p>Kvrocks cluster can be set up as simple as using those cluster commands, we even can write a script to watch and apply cluster changes. Those commands can be integrated into those companies which have their own cluster solution. Kvrocks also offers the <code>CLUSTERX VERSION</code> command to inspect current cluster topology information, the controller can force to update topology information when the version is out of date or wrong.</p><p>For a complete cluster solution, we need to depend on another controller to manage the topology information, failure detection, and failover. Kvrocks team is also developing the official controller to make the cluster manage and operate easier. But the manual resource is the bottleneck, welcome anyone who is interested in this project to build together.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="client-access">Client access<a href="#client-access" class="hash-link" aria-label="Direct link to Client access" title="Direct link to Client access">​</a></h2><p>Users can use Redis Cluster SDK to access the Kvrocks cluster since it&#x27;s compatible with the Redis cluster solution(Kvrocks supported <code>CLUSTER NODES</code> and <code>CLUSTER SLOTS</code> commands to respond to the cluster topology).  Kvrocks also responds to the <code>MOVED $slot_id $ip:$port</code> to redirect the target node when the slot is NOT served by the current node. You can also use the Redis Cluster Proxy like <code>redis-cluster-proxy</code> to hide the cluster topology.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-and-operate">Deploy and operate<a href="#deploy-and-operate" class="hash-link" aria-label="Direct link to Deploy and operate" title="Direct link to Deploy and operate">​</a></h2><p>Users need to self-manage the cluster topology information since the Kvrocks controller is still under development. The deployment steps are below:</p><ol><li>Deploy Kvrocks nodes</li><li>Design the kvrocks topology which is mentioned at <a href="#topology-management">topology management</a></li><li>Set node unique id for each node by using <code>CLUSTERX SETNODEID</code> command</li><li>Apply the topology information to all nodes by using <code>CLUSTER NODES</code> command</li></ol><p>Kvrocks would auto-setup the master-slave replication after receiving the setup topology command, and repeats steps 2-4 when we want to switch the node role or number.</p><p>Currently, Kvrocks topology modification is based on full state, that&#x27;s we need to sync the full topology information to each node, which may cause high network and cpu cost, but it can guarantee the correctness of the cluster. Also, the version-based modification can help us to achieve the increment modification if we want to do that, we would offer a way to add, update and delete nodes to make operation easier.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-command-and-safety">Cluster command And safety<a href="#cluster-command-and-safety" class="hash-link" aria-label="Direct link to Cluster command And safety" title="Direct link to Cluster command And safety">​</a></h2><p>To guarantee the correctness of client SDK, we rename the <code>CLUSTER</code> command to <code>CLUSTERX</code> to prevent the topology can being modified casually, but we can still use the <code>CLUSTER</code> command to fetch the cluster topology information.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cluster-scaling">Cluster scaling<a href="#cluster-scaling" class="hash-link" aria-label="Direct link to Cluster scaling" title="Direct link to Cluster scaling">​</a></h2><p>Kvrocks data migration is based on the slot instead of on key like Redis, we can migrate one slot to another node at once.</p><p>Kvrocks storage is based on disk instead of memory, so the key migration may be time cost. Now, the controller/DBA can use <code>CLUSTERX MIGRATE</code> command to migrate slots.</p><p>After <code>CLUSTERX MIGRATE</code> command to migrate the slot, you should use <code>CLUSTERX SETSLOT</code> to modify the topology information:</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">CLUSTERX SETSLOT </span><span class="token variable" style="color:#36acaa">$slot</span><span class="token plain"> NODE </span><span class="token variable" style="color:#36acaa">$node_id</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$new_version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>$slot</code>: assign which slot to be migrated</li><li><code>NODE</code>: same as the Redis cluster setslot</li><li><code>$dest_nodeid</code>: which node of the slot is to be migrated</li><li><code>$new_version</code>: the version of the topology information, noted that the version MUST be newer than the old version, or the node would refuse to apply the modification.</li></ul><p>For more information, see <a href="https://github.com/apache/kvrocks/pull/430" target="_blank" rel="noopener noreferrer">PR-430</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2><p>Kvrocks cluster implementation is compatible with the Redis cluster, in which users can use the Redis cluster client to access the Kvrocks cluster, also didn&#x27;t have the extra proxy latency like the Codis solution.</p><p>By the way, Kvrocks cluster topology management and scaling have finished from 2.0.6. We will continue improving the visibility, operation, and cluster management, to make the cluster better and easier.</p><p>For the Kvrocks controller, the community is building the official <a href="https://github.com/KvrocksLabs/kvrocks_controller" target="_blank" rel="noopener noreferrer">controller</a> to make the cluster management easier. Welcome anyone who is interested.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/kvrocks-website/tree/main/docs/cluster.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-01-17T04:37:43.000Z">Jan 17, 2024</time></b> by <b>tison</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/namespace"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Namespace</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/kvrocks-search"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Search</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#architect" class="table-of-contents__link toc-highlight">Architect</a></li><li><a href="#topology-management" class="table-of-contents__link toc-highlight">Topology management</a></li><li><a href="#node-management" class="table-of-contents__link toc-highlight">Node management</a></li><li><a href="#client-access" class="table-of-contents__link toc-highlight">Client access</a></li><li><a href="#deploy-and-operate" class="table-of-contents__link toc-highlight">Deploy and operate</a></li><li><a href="#cluster-command-and-safety" class="table-of-contents__link toc-highlight">Cluster command And safety</a></li><li><a href="#cluster-scaling" class="table-of-contents__link toc-highlight">Cluster scaling</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/supported-commands">Supported commands</a></li><li class="footer__item"><a class="footer__link-item" href="/community/contributing">How to contribute</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/kvrockscommunity/shared_invite/zt-p5928e3r-OUAK8SUgC8GOceGM6dAz6w" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/kvrocks/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issue Tracker<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://lists.apache.org/list.html?dev@kvrocks.apache.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mailing list<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Repositories</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/apache/kvrocks" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kvrocks<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/kvrocks-website" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/kvrocks-controller" target="_blank" rel="noopener noreferrer" class="footer__link-item">Controller<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.apache.org/" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/asf_logo.svg" alt="Apache logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo" height="128px"><img src="/img/asf_logo.svg" alt="Apache logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo" height="128px"></a></div><div class="footer__copyright"><div style="text-align: left;">
          <div style="border-top: 1px solid #ccc;min-height: 60px;line-height: 20px;text-align: center;font-family: Avenir-Medium,serif;font-size: 14px;color: #999;display: flex;align-items: center;"><span>Copyright © 2025 The Apache Software Foundation. Apache Kvrocks, Kvrocks, and its feather logo are trademarks of The Apache Software Foundation. Redis and its cube logo are registered trademarks of Redis Ltd.</span></div>
        </div></div></div></div></footer></div>
<script src="/assets/js/runtime~main.aee82a85.js"></script>
<script src="/assets/js/main.494d9540.js"></script>
</body>
</html>