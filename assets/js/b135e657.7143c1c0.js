"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[8973],{5680(e,r,a){a.d(r,{xA:()=>p,yg:()=>h});var t=a(6540);function n(e,r,a){return r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a,e}function o(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),a.push.apply(a,t)}return a}function s(e){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?o(Object(a),!0).forEach((function(r){n(e,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))}))}return e}function l(e,r){if(null==e)return{};var a,t,n=function(e,r){if(null==e)return{};var a,t,n={},o=Object.keys(e);for(t=0;t<o.length;t++)a=o[t],r.indexOf(a)>=0||(n[a]=e[a]);return n}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)a=o[t],r.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var i=t.createContext({}),c=function(e){var r=t.useContext(i),a=r;return e&&(a="function"==typeof e?e(r):s(s({},r),e)),a},p=function(e){var r=c(e.components);return t.createElement(i.Provider,{value:r},e.children)},d={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},u=t.forwardRef((function(e,r){var a=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=c(a),h=n,g=u["".concat(i,".").concat(h)]||u[h]||d[h]||o;return a?t.createElement(g,s(s({ref:r},p),{},{components:a})):t.createElement(g,s({ref:r},p))}));function h(e,r){var a=arguments,n=r&&r.mdxType;if("string"==typeof e||n){var o=a.length,s=new Array(o);s[0]=u;var l={};for(var i in r)hasOwnProperty.call(r,i)&&(l[i]=r[i]);l.originalType=e,l.mdxType="string"==typeof e?e:n,s[1]=l;for(var c=2;c<o;c++)s[c]=a[c];return t.createElement.apply(null,s)}return t.createElement.apply(null,a)}u.displayName="MDXCreateElement"},7811(e,r,a){a.r(r),a.d(r,{assets:()=>i,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var t=a(8168),n=(a(6540),a(5680));const o={id:"create-a-kvrocks-controller-release",title:"Create a kvrocks controller release"},s=void 0,l={unversionedId:"create-a-kvrocks-controller-release",id:"create-a-kvrocks-controller-release",title:"Create a kvrocks controller release",description:"This document mainly introduces how the Release Manager releases a new version in accordance with the Apache requirements.",source:"@site/community/create-a-kvrocks-controller-release.md",sourceDirName:".",slug:"/create-a-kvrocks-controller-release",permalink:"/community/create-a-kvrocks-controller-release",draft:!1,editUrl:"https://github.com/apache/kvrocks-website/tree/main/community/create-a-kvrocks-controller-release.md",tags:[],version:"current",frontMatter:{id:"create-a-kvrocks-controller-release",title:"Create a kvrocks controller release"},sidebar:"community",previous:{title:"Create a release",permalink:"/community/create-a-release"},next:{title:"Verify a release candidate",permalink:"/community/verify-a-release-candidate"}},i={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Create source releases and stage",id:"create-source-releases-and-stage",level:2},{value:"Upload artifacts to SVN dist repo",id:"upload-artifacts-to-svn-dist-repo",level:2},{value:"Build and push Docker images",id:"build-and-push-docker-images",level:2},{value:"Draft release note",id:"draft-release-note",level:2},{value:"Voting",id:"voting",level:2},{value:"Kvrocks community vote",id:"kvrocks-community-vote",level:3},{value:"Officially released",id:"officially-released",level:2},{value:"Publish artifacts to SVN RELEASE branch",id:"publish-artifacts-to-svn-release-branch",level:3},{value:"Publish Docker images",id:"publish-docker-images",level:3},{value:"Publish release note",id:"publish-release-note",level:3},{value:"Update website links",id:"update-website-links",level:3},{value:"Send the announcement",id:"send-the-announcement",level:3}],p={toc:c};function d(e){let{components:r,...a}=e;return(0,n.yg)("wrapper",(0,t.A)({},p,a,{components:r,mdxType:"MDXLayout"}),(0,n.yg)("p",null,"This document mainly introduces how the Release Manager releases a new version in accordance with the Apache requirements."),(0,n.yg)("h2",{id:"introduction"},"Introduction"),(0,n.yg)("p",null,"Apache Kvrocks\u2122 Controller is a cluster management tool for Apache Kvrocks\u2122. And the release process and policy of Apache Kvrocks Controller is similar to Apache Kvrocks\u2122:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Source Release is the key point which Apache values, also, is necessary for a release;"),(0,n.yg)("li",{parentName:"ul"},"Binary Release is optional. Apache Kvrocks\u2122 Controller can choose whether to release the binary package to the Apache repository or not.")),(0,n.yg)("p",null,"Note that for binary distribution packages, it is necessary to check that the new version does not contain third-party dependencies."),(0,n.yg)("p",null,"Please remember that publishing software has legal consequences. This guide complements the foundation-wide policies and guides:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://www.apache.org/legal/release-policy.html"},"Release Policy")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://infra.apache.org/release-distribution"},"Release Distribution Policy")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://infra.apache.org/release-publishing.html"},"Release Creation Process"))),(0,n.yg)("p",null,"For the first release manager, you need to add your PGP key to the KEYS file in the repository, please refer to ",(0,n.yg)("a",{parentName:"p",href:"https://kvrocks.apache.org/community/create-a-release/#adding-gpg-key"},"Adding GPG KEY"),"."),(0,n.yg)("h2",{id:"create-source-releases-and-stage"},"Create source releases and stage"),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},"Checkout to the RELEASE BRANCH and cherry-pick commits to release"),(0,n.yg)("li",{parentName:"ol"},"Use ",(0,n.yg)("inlineCode",{parentName:"li"},"./x.py package source -v ${release_version} -rc ${candidate_number}")," to create release tarball"),(0,n.yg)("li",{parentName:"ol"},"Make sure it compiles good and push tag to GitHub")),(0,n.yg)("h2",{id:"upload-artifacts-to-svn-dist-repo"},"Upload artifacts to SVN dist repo"),(0,n.yg)("admonition",{type:"info"},(0,n.yg)("p",{parentName:"admonition"},"SVN is required for this step.")),(0,n.yg)("p",null,"The svn repository of the dev branch is: ",(0,n.yg)("a",{parentName:"p",href:"https://dist.apache.org/repos/dist/dev/kvrocks/kvrocks-controller"},"https://dist.apache.org/repos/dist/dev/kvrocks/kvrocks-controller")),(0,n.yg)("p",null,"First, checkout Kvrocks controller to local directory:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},"# As this step will copy all the versions, it will take some time. If the network is broken, please use svn cleanup to delete the lock before re-execute it.\nsvn co https://dist.apache.org/repos/dist/dev/kvrocks/kvrocks-controller kvrocks-controller-dist-dev\n")),(0,n.yg)("p",null,"Then, upload the artifacts:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},'cd kvrocks-controller-dist-dev\nmkdir ${release_version} # create a directory named by version\ncp ${repo_dir}/apache-kvrocks-controller-${release_version}-src.tar.gz* ${release_version}/ # copy source code and signature package to the versioned directory\nsvn status # check svn status\nsvn add ${release_version} # add to svn\nsvn status # check svn status\nsvn commit -m "Prepare for ${release_version}"     # commit to SVN remote server\n')),(0,n.yg)("h2",{id:"build-and-push-docker-images"},"Build and push Docker images"),(0,n.yg)("admonition",{type:"info"},(0,n.yg)("p",{parentName:"admonition"},"Docker and Docker Buildx is required for this step. Docker Buildx should be bundled with Docker Desktop. If you don't use Docker Desktop, please follow the ",(0,n.yg)("a",{parentName:"p",href:"https://docs.docker.com/build/install-buildx/"},"installation guide")," to install it.")),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("inlineCode",{parentName:"li"},"docker login")," to your own DockerHub account."),(0,n.yg)("li",{parentName:"ol"},"Build and push docker images to your personal repository on DockerHub:"),(0,n.yg)("li",{parentName:"ol"},"MORE BUILD ARGS can be adjusted according to the performance of your computer")),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},'docker buildx create --name ${your_builder_name} --use --driver-opt network=host\ndocker buildx inspect --bootstrap\ndocker buildx build --platform linux/amd64,linux/arm64 --tag ${your_dockerhub_username}/kvrocks-controller:${release_version} --tag ${your_dockerhub_username}/kvrocks-controller:latest . --output "type=registry"\n')),(0,n.yg)("h2",{id:"draft-release-note"},"Draft release note"),(0,n.yg)("p",null,(0,n.yg)("a",{parentName:"p",href:"https://github.com/apache/kvrocks-controller/releases/new"},"Draft a new release note"),"."),(0,n.yg)("p",null,"You should choose the current release candidate tag. GitHub can automatically generate the content of release note, but you need to group it."),(0,n.yg)("p",null,"For some important content, highlight it at the beginning."),(0,n.yg)("h2",{id:"voting"},"Voting"),(0,n.yg)("h3",{id:"kvrocks-community-vote"},"Kvrocks community vote"),(0,n.yg)("p",null,"Kvrocks community vote\uff0csend email to: ",(0,n.yg)("inlineCode",{parentName:"p"},"dev@kvrocks.apache.org"),":"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-text"},"[VOTE] Release Apache Kvrocks Controller ${release_version}\n\nHello Apache Kvrocks PMC and Community,\n\n    This is a call for a vote to release Apache Kvrocks Controller version ${release_version}.\n\n    The tag to be voted on is ${release_version}-rc${candidate_number}.\n\n    The release candidate:\n\n    https://dist.apache.org/repos/dist/dev/kvrocks/kvrocks-controller/${release_version}/\n\n\n    Keys to verify the release candidate:\n\n    https://downloads.apache.org/kvrocks/KEYS\n\n\n    Git tag for the release:\n\n    https://github.com/apache/kvrocks-controller/releases/tag/v${release_version}-rc${candidate_number}\n\n    Docker images for the release candidate:\n\n    {docker_image_link}\n\n    Please download, verify, and test.\n\n    The VOTE will remain open for at least 72 hours.\n\n    [ ] +1 approve\n    [ ] +0 no opinion\n    [ ] -1 disapprove with the reason\n\n    To learn more about apache kvrocks, please see\n    https://kvrocks.apache.org/\n\n    Checklist for reference:\n\n      [ ] Download links are valid.\n      [ ] Checksums and signatures.\n      [ ] LICENSE/NOTICE files exist\n      [ ] No unexpected binary files\n      [ ] All source files have ASF headers\n      [ ] Can compile from source\n      [ ] All Tests Passed\n      [ ] Docker image with right version\n      [ ] Docker image contains license files\n      [ ] Docker image can work well\n\n      More detailed checklist, please refer to:\n      https://kvrocks.apache.org/community/verify-a-release-candidate\n\nThanks\n")),(0,n.yg)("p",null,"After at least 72 hours with at least 3 +1 binding vote (from Kvrocks PMC member) and no veto, claim the vote result:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-text"},"[RESULT][VOTE] Release Apache Kvrocks Controller ${release_version}\n\nThe vote to release Apache Kvrocks Controller ${release_version} has passed.\n\nThe vote PASSED with xxx binding +1 and 0 -1 votes:\n\nBinding votes:\n- XXX\n- XXX\n- XXX\n\nNo Binding votes:\n- XXX\n- XXX\n- XXX\n\nVote thread:\n\n${vote_thread_url}\n\nThank you to all the above members to help us to verify and vote for the\n${release_version} release.\n\nThanks\n")),(0,n.yg)("h2",{id:"officially-released"},"Officially released"),(0,n.yg)("h3",{id:"publish-artifacts-to-svn-release-branch"},"Publish artifacts to SVN RELEASE branch"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},'svn mv https://dist.apache.org/repos/dist/dev/kvrocks/kvrocks-controller/${release_version} https://dist.apache.org/repos/dist/release/kvrocks/kvrocks-controller/${release_version} -m "Release ${release_version}"\n')),(0,n.yg)("h3",{id:"publish-docker-images"},"Publish Docker images"),(0,n.yg)("p",null,"Copy the approved candidate docker images from your personal account to apache org:"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-shell"},"docker buildx imagetools create -t apache/kvrocks-controller:${release_version} ${your_dockerhub_username}/kvrocks-controller:${release_version}\ndocker buildx imagetools create -t apache/kvrocks-controller:latest ${your_dockerhub_username}/kvrocks-controller:latest\n")),(0,n.yg)("admonition",{type:"caution"},(0,n.yg)("p",{parentName:"admonition"},"If you don't have the permission, you can ask someone with access to apache org to do that.")),(0,n.yg)("h3",{id:"publish-release-note"},"Publish release note"),(0,n.yg)("p",null,"Edit the title of the draft release note and use the new ${release_version} tag, which github will create automatically."),(0,n.yg)("p",null,"Then, publish release."),(0,n.yg)("h3",{id:"update-website-links"},"Update website links"),(0,n.yg)("p",null,"Update ",(0,n.yg)("a",{parentName:"p",href:"https://github.com/apache/kvrocks-website/blob/main/src/components/Releases/kvrocks-controller.tsx"},"releases data file"),"."),(0,n.yg)("h3",{id:"send-the-announcement"},"Send the announcement"),(0,n.yg)("p",null,"Send the release announcement to ",(0,n.yg)("inlineCode",{parentName:"p"},"dev@kvrocks.apache.org")," and CC ",(0,n.yg)("inlineCode",{parentName:"p"},"announce@apache.org"),":"),(0,n.yg)("blockquote",null,(0,n.yg)("p",{parentName:"blockquote"},"You have to use ",(0,n.yg)("inlineCode",{parentName:"p"},"${name}@apache.org")," post email to ",(0,n.yg)("inlineCode",{parentName:"p"},"announce@apache.org"))),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-html"},"[ANNOUNCE] Release Apache Kvrocks Controller ${release_version}\n\nHi all,\n\nThe Apache Kvrocks community is pleased to announce\nthat Apache Kvrocks Controller ${release_version} has been released!\n\nApache Kvrocks Controller is a cluster management tool for Apache Kvrocks, including the following key features:\n\n- Failover - controller will failover or remove the master/slave node when probing failed\n- Scale out the cluster in one line command\n- Manage many clusters in one controller cluster\n- Support multi metadata storages like etcd and so on\n\nThis release contains a number of new features, bug fixes and\nimprovements compared to the last version released before.\nThe notable changes since ${release_version} include:\n1. xxxxx\n2. yyyyyy\n3. zzzzzz\n\nPlease refer to the change log for the complete list of changes:\nhttps://github.com/apache/kvrocks-controller/releases/tag/v${release_version}\n\nApache Kvrocks website: https://kvrocks.apache.org/\n\nDownload Links: https://kvrocks.apache.org/download/kvrocks-controller\n\nKvrocks Resources:\n- Issue: https://github.com/apache/kvrocks-controller/issues\n- Mailing list: dev@kvrocks.apache.org\n\nThanks\nOn behalf of Apache Kvrocks community\n")))}d.isMDXComponent=!0}}]);